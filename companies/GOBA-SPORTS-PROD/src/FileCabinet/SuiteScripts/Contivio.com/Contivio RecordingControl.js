var contivioUrl="https://usweb4.contivio.com/Contivio.Adt.Web.Site/10.0.6/cmd.htm?";var sensitiveFields=["ccnumber","ccexpiredate","ccname","ccstreet","cczipcode","ccsecuritycode","inpt_creditcard","creditcard","inpt_paymentmethod","creditcard_popup_new","creditcard_popup_link"];var CCWindowCloseNextFieldId="ccnumber";var observerLoaded=false;var lastRecordingCommand=null;var ccwindow=null;var pollMonitor=null;window.open=function(b){return function(f,a,e){a=a||"default_window_name";console.log("detected attempt to open window with URL:"+f);if(f.indexOf("creditcard")>=0){SuspendOrResumeRecording(true,"openccwin");ccwindow=b.call(window,f,a,e);if(!pollMonitor){pollMonitor=window.setInterval(function(){if(ccwindow.closed){window.clearInterval(pollMonitor);pollMonitor=null;console.log("Monitored window is now closed.");window.setTimeout(HandleCCWindowClose,100)}},1000)}return ccwindow}else{return b.call(window,f,a,e)}}}(window.open);function HandleCCWindowClose(){try{console.log("HandleCCWindowClose");if(CCWindowCloseNextFieldId){document.getElementById(CCWindowCloseNextFieldId).focus()}}catch(b){}window.setTimeout(CheckForRestore,500)}function IsCCWindowOpen(){if(ccwindow&&!ccwindow.closed){return true}else{return false}}function AttachRecordingEventsHandler(){try{if(!observerLoaded){observerLoaded=true;for(var j=0;j<sensitiveFields.length;j++){var i=document.getElementById(sensitiveFields[j]);if(i){i.addEventListener("focus",function(a){SuspendOrResumeRecording(true,"focus")});i.addEventListener("blur",function(a){window.setTimeout(CheckForRestore,1000)})}else{var f=document.getElementsByName(sensitiveFields[j]);for(var g=0;g<f.length;g++){f[g].addEventListener("focus",function(a){SuspendOrResumeRecording(true,"focus")});f[g].addEventListener("blur",function(a){window.setTimeout(CheckForRestore,1000)})}}}}}catch(h){console.log(h)}}function IsSensitiveField(){var g=document.activeElement;var f=g?g.id||g.tagName||g:"";var h=g?g.name:"";console.log("IsSensitiveField found: Id="+f+" Name="+h);for(var e=0;e<sensitiveFields.length;e++){if(f==sensitiveFields[e]||h==sensitiveFields[e]){return true}}return false}function SuspendOrResumeRecording(c,d){console.log("SuspendOrResumeRecording: "+c+" Event: "+d);if(lastRecordingCommand==null&&c==false){return}if(lastRecordingCommand!=c){lastRecordingCommand=c;console.log("Suspend Recording? "+c);SendContivioCommand(c)}}function CheckForRestore(){console.log("CheckForRestore current element: "+document.activeElement.id);if(!IsSensitiveField()&&!IsCCWindowOpen()){SuspendOrResumeRecording(false,"blur")}else{console.log("Suspend recording ignored, on another sensitive field or CC window is open")}}function SendContivioCommand(j){var l=j?"suspendrecording":"restorerecording";var g=0;var i=0;var k=200;var h=100;if((parseInt(navigator.appVersion)>=4)){g=(screen.width-k)}window.open(contivioUrl+l,"ContivioRecordingCommand","width="+k+",height="+h+",location=no,menubar=no,resizable=no,scrollbars=no,status=no,titlebar=no,screenx="+g+",left="+g+",screeny="+i+",top="+i)};